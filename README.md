# Power Analysis 

### Introduction
*Given a series of visual fields, how likely are we to detect change if meaningful change of a particular magnitude has taken place?* 

We propose an approach based on Monte-carlo simulation, where we introduce artificial 'progression signals' of varying magnitudes to randomly selected visual field (VF) locations. The modified series is then analysed with Permutation of Pointwise Linear Regression (PoPLR) which generates a p-value, i.e. statistically significant change if p<0.05. This is repeated 100 times and the proportion of statistically significant iterations is taken as the statistical power of the progression analysis to detect change of a particular magnitude.  

### Code directory
- **'simulation_function.R'** is the main code file. It contains a function called 'power_analysis' which takes as input a VF dataset specifically formatted for the open source R package [*visualFields*](https://cran.r-project.org/web/packages/visualFields/visualFields.pdf) and return a CSV file with the power estimates for each individual's VF series.
- **'run_analysis.R'** runs the power analysis on two datasets, namely [Artes et al. (2014)](https://pubmed.ncbi.nlm.nih.gov/24878173/) and [Montesano et al. (2022)](https://tvst.arvojournals.org/article.aspx?articleid=2778219).
- **empty_plot.R**, **plot_indiv.R** and **plot_avg.R** are function files for plotting power against rates of progression.
- **uwvf_config.R** is a function file for formatting the raw visual field dataset from Montesano et al. (2022) (PS: may not work now, as I have not updated the code).
- **vf_config.R** is a function file for formatting the raw visual field dataset from Artes et al. (2014) (PS: may not work now, as I have not updated the code).

### Data directory
- **'artes2014.csv'**: raw VF dataset from Artes et al. (2014) (also freely available in R *visualFields* as 'vfpwgRetest24d2').
- **'raw_uwvf.csv'**: raw VF dataset from Montesano et al. (2022) (downloaded from [here](https://github.com/uw-biomedical-ml/uwhvf)).
- **'conf_uwvf.csv'**: Configured 'raw_uwvf.csv' as per *visualFields* format.
- **'eligible_conf_uwvf.csv'**: only includes VF series with at least 5 VF tests (at each individual's eye level) from 'conf_uwvf.csv'. 

### Plot directory
Please ignore for now because it contains mainly plots generated by the old scripts (previous version of power analysis). However, plots below might be of interest:
- **fixed_first_5_plot_indiv.pdf**: power curves for each of the 30 participants in Artes et al. (2014) where only the first 5 of the 12 VFs are used for the analysis, generated using *code/plot.R*. 
- **svf_combined.pdf**: serial visualisation of grayscale VF plots for each of the 30 participants in Artes et al. (2014).
- **grayscale_sparklines_px.pdf**: grayscale VF plot where each VF location is overlayed with a sparkline graph showing test variability across the first 5 VFs for each of the 30 participants in Artes et al. (2014).
